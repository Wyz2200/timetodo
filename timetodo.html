<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸Šæ¬¡æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ</title>
    <style>
        :root {
            --primary: #4F46E5;
            --bg: #F3F4F6;
            --card-bg: #FFFFFF;
            --text-main: #1F2937;
            --text-sub: #6B7280;
            --danger: #EF4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; }

        /* header */
        header { background: var(--card-bg); padding: 15px; text-align: center; font-weight: bold; font-size: 1.2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 10; }

        /* Main Content Area */
        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }

        /* Pages */
        .page { display: none; }
        .page.active { display: block; }

        /* Event Card */
        .card { background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .event-title { font-size: 1.1rem; font-weight: 600; }
        .time-elapsed { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 10px 0; }
        .last-date { font-size: 0.85rem; color: var(--text-sub); }

        /* Buttons */
        .btn { border: none; padding: 10px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; font-weight: 500; transition: opacity 0.2s; width: 100%; text-align: center; }
        .btn:active { opacity: 0.7; }
        .btn-primary { background-color: var(--primary); color: white; margin-top: 10px; }
        .btn-outline { background-color: transparent; border: 1px solid #E5E7EB; color: var(--text-sub); margin-top: 8px; }
        .btn-danger { background-color: var(--danger); color: white; margin-top: 20px; }

        /* History Section */
        .history-list { margin-top: 15px; border-top: 1px solid #E5E7EB; padding-top: 10px; display: none; }
        .history-list.show { display: block; }
        .history-item { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-sub); padding: 5px 0; border-bottom: 1px dashed #eee; }
        .btn-del-history { color: var(--danger); background: none; border: none; cursor: pointer; font-size: 0.8rem; }

        /* Modal (Add Event) */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 85%; max-width: 300px; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; margin: 15px 0; font-size: 1rem; }

        /* Navbar */
        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #E5E7EB; display: flex; justify-content: space-around; align-items: center; padding: 10px 0; padding-bottom: max(10px, env(safe-area-inset-bottom)); box-shadow: 0 -2px 10px rgba(0,0,0,0.03); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-sub); font-size: 0.75rem; border: none; background: none; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.4rem; margin-bottom: 2px; }
        
        /* The Big Plus Button */
        .nav-add-btn { background: var(--primary); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; border: none; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4); transform: translateY(-15px); cursor: pointer; }
    </style>
</head>
<body>

    <header id="header-title">æˆ‘çš„æ™‚é–“ç´€éŒ„</header>

    <main>
        <div id="home-page" class="page active">
            <div id="event-list"></div>
            <div id="empty-state" style="text-align: center; color: #9CA3AF; margin-top: 50px; display: none;">
                é‚„æ²’æœ‰ç´€éŒ„äº‹é …<br>é»æ“Šä¸‹æ–¹ + æ–°å¢ä¸€å€‹å§ï¼
            </div>
        </div>

        <div id="settings-page" class="page">
            <div class="card">
                <div class="event-title">è³‡æ–™ç®¡ç†</div>
                <p style="color: var(--text-sub); font-size: 0.9rem;">æ‰€æœ‰è³‡æ–™éƒ½å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚</p>
                <button class="btn btn-danger" onclick="clearAllData()">âš ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
            </div>
            <div class="card">
                <div class="event-title">é—œæ–¼</div>
                <p style="color: var(--text-sub); font-size: 0.9rem;">é€™æ˜¯ä¸€å€‹ç°¡æ˜“çš„æ™‚é–“è¿½è¹¤å·¥å…·ï¼Œå¹«åŠ©ä½ è¨˜æ†¶ä¸Šæ¬¡åšæŸä»¶äº‹çš„æ™‚é–“ã€‚</p>
            </div>
        </div>
    </main>

    <div id="add-modal" class="modal">
        <div class="modal-content">
            <div class="event-title">æ–°å¢è¿½è¹¤äº‹é …</div>
            <input type="text" id="new-event-name" placeholder="ä¾‹å¦‚ï¼šæ›åºŠå–®ã€æ¾†æ°´...">
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-outline" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveNewEvent()">ç¢ºèªæ–°å¢</button>
            </div>
        </div>
    </div>

    <nav class="navbar">
        <button class="nav-item active" onclick="switchPage('home')">
            <span class="nav-icon">ğŸ </span>
            <span>ä¸»é </span>
        </button>
        <button class="nav-add-btn" onclick="openModal()">
            +
        </button>
        <button class="nav-item" onclick="switchPage('settings')">
            <span class="nav-icon">âš™ï¸</span>
            <span>è¨­å®š</span>
        </button>
    </nav>

    <script>
        // --- è³‡æ–™çµæ§‹èˆ‡åˆå§‹åŒ– ---
        // Events Array: [{ id: 123, name: "æ¾†æ°´", logs: [timestamp1, timestamp2] }]
        let events = JSON.parse(localStorage.getItem('myTimeTracker_events')) || [];

        function saveToLocal() {
            localStorage.setItem('myTimeTracker_events', JSON.stringify(events));
            renderEvents();
        }

        // --- æ™‚é–“æ ¼å¼åŒ–é‚è¼¯ ---
        function formatDuration(ms) {
            if (!ms) return "å°šæœªåŸ·è¡Œ";
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days}å¤© ${hours % 24}å°æ™‚`;
            if (hours > 0) return `${hours}å°æ™‚ ${minutes % 60}åˆ†`;
            if (minutes > 0) return `${minutes}åˆ†é˜å‰`;
            return "å‰›å‰›";
        }

        function formatDate(timestamp) {
            return new Date(timestamp).toLocaleString('zh-TW', { hour12: false });
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        // 1. æ–°å¢äº‹ä»¶
        function openModal() {
            document.getElementById('add-modal').classList.add('show');
            document.getElementById('new-event-name').focus();
        }

        function closeModal() {
            document.getElementById('add-modal').classList.remove('show');
            document.getElementById('new-event-name').value = '';
        }

        function saveNewEvent() {
            const name = document.getElementById('new-event-name').value.trim();
            if (!name) return alert('è«‹è¼¸å…¥åç¨±');
            
            const newEvent = {
                id: Date.now(),
                name: name,
                logs: [] // åˆå§‹æ²’æœ‰ç´€éŒ„
            };
            
            events.push(newEvent);
            saveToLocal();
            closeModal();
            switchPage('home');
        }

        // 2. ç´€éŒ„æ™‚é–“ (æ‰“å¡)
        function logTime(id) {
            const event = events.find(e => e.id === id);
            if (event) {
                event.logs.unshift(Date.now()); // åŠ åˆ°æœ€å‰é¢
                saveToLocal();
            }
        }

        // 3. åˆªé™¤ç‰¹å®šæ­·å²ç´€éŒ„
        function deleteLog(eventId, logIndex) {
            if(confirm('ç¢ºå®šåˆªé™¤é€™æ¢ç´€éŒ„å—ï¼Ÿ')) {
                const event = events.find(e => e.id === eventId);
                event.logs.splice(logIndex, 1);
                saveToLocal();
            }
        }

        // 4. åˆªé™¤æ•´å€‹äº‹ä»¶
        function deleteEvent(id) {
            if(confirm('ç¢ºå®šåˆªé™¤é€™å€‹äº‹ä»¶èˆ‡æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) {
                events = events.filter(e => e.id !== id);
                saveToLocal();
            }
        }

        // 5. åˆ‡æ›æ­·å²é¡¯ç¤º
        function toggleHistory(id) {
            const el = document.getElementById(`history-${id}`);
            if (el.style.display === 'block') {
                el.style.display = 'none';
            } else {
                el.style.display = 'block';
            }
        }

        // --- æ¸²æŸ“ç•«é¢ (UI) ---
        function renderEvents() {
            const list = document.getElementById('event-list');
            const emptyState = document.getElementById('empty-state');
            
            list.innerHTML = '';
            
            if (events.length === 0) {
                emptyState.style.display = 'block';
                return;
            } else {
                emptyState.style.display = 'none';
            }

            // æ ¹æ“šä¸Šæ¬¡åŸ·è¡Œæ™‚é–“æ’åº (è¶Šä¹…æ²’åšçš„æ’è¶Šä¸Šé¢? æˆ–è€…å›ºå®šçš„? é€™è£¡æš«è¨­ç‚ºå›ºå®šæ–°å¢é †åºï¼Œå¯æ”¹)
            events.forEach(evt => {
                const lastLog = evt.logs.length > 0 ? evt.logs[0] : null;
                const timeDiff = lastLog ? Date.now() - lastLog : null;
                const displayTime = lastLog ? formatDuration(timeDiff) : "å°šæœªåŸ·è¡Œ";
                
                // æ­·å²ç´€éŒ„ HTML
                let historyHtml = '';
                evt.logs.forEach((log, index) => {
                    historyHtml += `
                        <div class="history-item">
                            <span>${formatDate(log)}</span>
                            <button class="btn-del-history" onclick="deleteLog(${evt.id}, ${index})">åˆªé™¤</button>
                        </div>
                    `;
                });

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="event-title">${evt.name}</div>
                        <button style="border:none;background:none;color:#999;" onclick="deleteEvent(${evt.id})">âœ•</button>
                    </div>
                    <div class="last-date">${lastLog ? 'ä¸Šæ¬¡ï¼š' + formatDate(lastLog) : 'æ–°äº‹ä»¶'}</div>
                    <div class="time-elapsed">${displayTime}</div>
                    
                    <button class="btn btn-primary" onclick="logTime(${evt.id})">âœ”ï¸ å‰›å‰›åšäº†</button>
                    <button class="btn btn-outline" onclick="toggleHistory(${evt.id})">ğŸ“‹ æ­·å²ç´€éŒ„</button>
                    
                    <div id="history-${evt.id}" class="history-list">
                        ${historyHtml || '<div style="text-align:center;padding:10px;">å°šç„¡ç´€éŒ„</div>'}
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // --- é é¢åˆ‡æ› ---
        function switchPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            if (pageName === 'home') {
                document.getElementById('home-page').classList.add('active');
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
                document.getElementById('header-title').innerText = "æˆ‘çš„æ™‚é–“ç´€éŒ„";
            } else if (pageName === 'settings') {
                document.getElementById('settings-page').classList.add('active');
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
                document.getElementById('header-title').innerText = "è¨­å®š";
            }
        }

        function clearAllData() {
            if(confirm("é€™å°‡æœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ä¸”ç„¡æ³•å¾©åŸï¼ç¢ºå®šå—ï¼Ÿ")) {
                localStorage.removeItem('myTimeTracker_events');
                events = [];
                renderEvents();
                alert("è³‡æ–™å·²æ¸…é™¤");
            }
        }

        // --- å•Ÿå‹•èˆ‡è‡ªå‹•æ›´æ–° ---
        
        // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡ä»‹é¢ä¸Šçš„æ™‚é–“é¡¯ç¤º
        setInterval(() => {
            if(document.getElementById('home-page').classList.contains('active')) {
                renderEvents();
            }
        }, 60000);

        // åˆå§‹æ¸²æŸ“
        renderEvents();
    </script>
</body>
</html>
