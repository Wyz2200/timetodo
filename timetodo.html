<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÊôÇÈñìÁ¥ÄÈåÑ App</title>
    <style>
        :root {
            --primary: #4F46E5;
            --primary-light: #EEF2FF;
            --bg: #F9FAFB;
            --card-bg: #FFFFFF;
            --text-main: #111827;
            --text-sub: #6B7280;
            --danger: #EF4444;
            --border: #E5E7EB;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; }

        /* Icons */
        .icon { width: 24px; height: 24px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 18px; height: 18px; }

        /* Header */
        header { background: var(--card-bg); padding: 15px; text-align: center; font-weight: 700; font-size: 1.1rem; border-bottom: 1px solid var(--border); z-index: 10; display: flex; align-items: center; justify-content: center; height: 60px; }

        /* Main Content */
        main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px; }

        /* Hero Section (Pinned Event) */
        .hero-section { margin-bottom: 25px; }
        .hero-label { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 8px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }
        
        .hero-card { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%); color: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4); position: relative; }
        .hero-card .event-title { font-size: 1.4rem; font-weight: 600; opacity: 0.95; }
        .hero-card .time-elapsed { font-size: 2.5rem; font-weight: 800; margin: 15px 0; line-height: 1.1; }
        .hero-card .last-date { font-size: 0.9rem; opacity: 0.8; margin-bottom: 20px; }
        .hero-card .btn-primary { background: white; color: var(--primary); font-weight: bold; border: none; }
        .hero-card .btn-outline { color: white; border-color: rgba(255,255,255,0.3); }
        .hero-card .menu-btn { color: white; }

        /* Standard List Section */
        .list-label { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 10px; font-weight: 600; margin-top: 10px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border); position: relative; }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .event-title { font-size: 1.1rem; font-weight: 600; color: var(--text-main); }
        .time-elapsed { font-size: 1.6rem; font-weight: 700; color: var(--primary); margin: 8px 0; }
        .last-date { font-size: 0.85rem; color: var(--text-sub); }

        /* Menu (Three Dots) */
        .menu-container { position: relative; }
        .menu-btn { background: none; border: none; padding: 5px; cursor: pointer; color: #9CA3AF; border-radius: 50%; transition: background 0.2s; }
        .menu-btn:hover { background: rgba(0,0,0,0.05); color: var(--text-main); }
        
        .dropdown { position: absolute; top: 30px; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--border); width: 140px; display: none; z-index: 50; overflow: hidden; }
        .dropdown.show { display: block; }
        .dropdown-item { padding: 12px 15px; font-size: 0.9rem; color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.1s; }
        .dropdown-item:hover { background: var(--bg); }
        .dropdown-item.danger { color: var(--danger); }

        /* Buttons */
        .btn { border: none; padding: 12px; border-radius: 10px; font-size: 0.95rem; cursor: pointer; font-weight: 500; width: 100%; text-align: center; transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--primary); color: white; margin-top: 10px; box-shadow: 0 2px 5px rgba(79, 70, 229, 0.2); }
        .btn-outline { background-color: transparent; border: 1px solid var(--border); color: var(--text-sub); margin-top: 8px; }
        
        /* History List */
        .history-list { margin-top: 15px; border-top: 1px solid rgba(0,0,0,0.08); padding-top: 10px; display: none; }
        .hero-card .history-list { border-top-color: rgba(255,255,255,0.2); }
        .history-item { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 8px 0; border-bottom: 1px dashed rgba(0,0,0,0.1); opacity: 0.8; }
        .hero-card .history-item { border-bottom-color: rgba(255,255,255,0.2); color: white; }

        /* Navbar */
        .navbar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; padding: 8px 0; padding-bottom: max(10px, env(safe-area-inset-bottom)); box-shadow: 0 -4px 20px rgba(0,0,0,0.02); z-index: 20; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #9CA3AF; font-size: 0.7rem; background: none; border: none; cursor: pointer; flex: 1; padding: 5px; }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { margin-bottom: 4px; }
        
        .nav-add-btn { background: var(--primary); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: none; box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3); transform: translateY(-20px); cursor: pointer; transition: transform 0.2s; }
        .nav-add-btn:active { transform: translateY(-20px) scale(0.95); }

        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; backdrop-filter: blur(2px); }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin: 15px 0; font-size: 1rem; background: var(--bg); }
        
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body>

    <main onclick="closeAllMenus(event)">
        <div id="home-page" class="page active">
            <div id="hero-container"></div>
            
            <div id="list-label" class="list-label" style="display:none;">ÂÖ∂‰ªñ‰∫ãÈ†Ö</div>
            <div id="event-list"></div>
            
            <div id="empty-state" style="text-align: center; color: var(--text-sub); margin-top: 100px; display: none;">
                <div style="font-size: 3rem; margin-bottom: 10px; opacity: 0.3;">üìù</div>
                ÈÇÑÊ≤íÊúâÁ¥ÄÈåÑ‰∫ãÈ†Ö<br>ÈªûÊìä‰∏ãÊñπ + Êñ∞Â¢û‰∏ÄÂÄãÂêßÔºÅ
            </div>
        </div>

        <div id="settings-page" class="page">
            <header style="background:transparent; border:none; margin-bottom:10px; justify-content: flex-start; padding-left: 0;">Ë®≠ÂÆö</header>
            <div class="card">
                <div class="event-title">Ë≥áÊñôÁÆ°ÁêÜ</div>
                <p style="color: var(--text-sub); font-size: 0.9rem; margin: 10px 0;">ÊâÄÊúâË≥áÊñôÈÉΩÂÑ≤Â≠òÂú®ÊÇ®ÁöÑÁÄèË¶ΩÂô®‰∏≠„ÄÇ</p>
                <button class="btn btn-outline" style="color: var(--danger); border-color: var(--danger);" onclick="clearAllData()">‚ö†Ô∏è Ê∏ÖÈô§ÊâÄÊúâË≥áÊñô</button>
            </div>
        </div>
    </main>

    <div id="add-modal" class="modal">
        <div class="modal-content">
            <div class="event-title">Êñ∞Â¢ûËøΩËπ§‰∫ãÈ†Ö</div>
            <input type="text" id="new-event-name" placeholder="Ëº∏ÂÖ•‰∫ãÈ†ÖÂêçÁ®±...">
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-outline" onclick="closeModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveNewEvent()">Á¢∫Ë™çÊñ∞Â¢û</button>
            </div>
        </div>
    </main>

    <nav class="navbar">
        <button class="nav-item active" onclick="switchPage('home')">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span style="margin-top:2px">‰∏ªÈ†Å</span>
        </button>
        <button class="nav-add-btn" onclick="openModal()">
            <svg class="icon" style="width:32px; height:32px;" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
        <button class="nav-item" onclick="switchPage('settings')">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            <span style="margin-top:2px">Ë®≠ÂÆö</span>
        </button>
    </nav>

    <script>
        // --- Data ---
        let events = JSON.parse(localStorage.getItem('myTimeTracker_events_v2')) || [];

        function saveToLocal() {
            localStorage.setItem('myTimeTracker_events_v2', JSON.stringify(events));
            renderEvents();
        }

        // --- Helpers ---
        function formatDuration(ms) {
            if (!ms) return "Â∞öÊú™Âü∑Ë°å";
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days}Â§© ${hours % 24}Â∞èÊôÇ`;
            if (hours > 0) return `${hours}Â∞èÊôÇ ${minutes % 60}ÂàÜ`;
            if (minutes > 0) return `${minutes}ÂàÜÈêòÂâç`;
            return "ÂâõÂâõ";
        }

        function formatDate(timestamp) {
            return new Date(timestamp).toLocaleString('zh-TW', { hour12: false, month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit' });
        }

        // --- Core Logic ---
        
        function openModal() {
            document.getElementById('add-modal').classList.add('show');
            document.getElementById('new-event-name').focus();
        }

        function closeModal() {
            document.getElementById('add-modal').classList.remove('show');
            document.getElementById('new-event-name').value = '';
        }

        function saveNewEvent() {
            const name = document.getElementById('new-event-name').value.trim();
            if (!name) return;
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÂÄã‰∫ã‰ª∂ÔºåËá™ÂãïË®≠ÁÇ∫ÁΩÆÈ†Ç
            const isFirst = events.length === 0;

            events.push({
                id: Date.now(),
                name: name,
                logs: [],
                isPinned: isFirst 
            });
            saveToLocal();
            closeModal();
            switchPage('home');
        }

        function logTime(id) {
            const event = events.find(e => e.id === id);
            if (event) {
                event.logs.unshift(Date.now());
                saveToLocal();
            }
        }

        function deleteLog(eventId, logIndex) {
            if(confirm('Âà™Èô§Ê≠§Ê¢ùÊ≠∑Âè≤Á¥ÄÈåÑÔºü')) {
                const event = events.find(e => e.id === eventId);
                event.logs.splice(logIndex, 1);
                saveToLocal();
            }
        }

        function deleteEvent(id) {
            if(confirm('Á¢∫ÂÆöÂà™Èô§Ê≠§‰∫ã‰ª∂ÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                events = events.filter(e => e.id !== id);
                saveToLocal();
            }
        }

        function togglePin(id) {
            // ÈÇèËºØÔºöÂè™ËÉΩÊúâ‰∏ÄÂÄãÁΩÆÈ†Ç„ÄÇÂ¶ÇÊûúÈªûÊìäÂ∑≤ÁΩÆÈ†ÇÁöÑÔºåÂâáÂèñÊ∂àÁΩÆÈ†Ç„ÄÇ
            // Â¶ÇÊûúÈªûÊìäÊú™ÁΩÆÈ†ÇÁöÑÔºåÂâáÂ∞áÂÖ∂‰ªñÂèñÊ∂àÁΩÆÈ†ÇÔºå‰∏¶ÁΩÆÈ†ÇÁï∂ÂâçÈÄôÂÄã„ÄÇ
            const target = events.find(e => e.id === id);
            if (target.isPinned) {
                target.isPinned = false;
            } else {
                events.forEach(e => e.isPinned = false); // Ê∏ÖÈô§ÂÖ∂‰ªñ
                target.isPinned = true;
            }
            saveToLocal();
        }

        function toggleHistory(id) {
            const el = document.querySelector(`#card-${id} .history-list`);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        // --- Menu Logic ---
        function toggleMenu(event, id) {
            event.stopPropagation(); // Èò≤Ê≠¢ÂÜíÊ≥°Ëß∏Áôº body click
            // ÈóúÈñâÂÖ∂‰ªñÂ∑≤ÈñãÂïüÁöÑÈÅ∏ÂñÆ
            document.querySelectorAll('.dropdown').forEach(d => {
                if (d.id !== `menu-${id}`) d.classList.remove('show');
            });
            
            const menu = document.getElementById(`menu-${id}`);
            menu.classList.toggle('show');
        }

        function closeAllMenus(event) {
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('show'));
        }

        // --- Rendering ---
        
        function generateCardHTML(evt, isHero) {
            const lastLog = evt.logs.length > 0 ? evt.logs[0] : null;
            const timeDiff = lastLog ? Date.now() - lastLog : null;
            const displayTime = lastLog ? formatDuration(timeDiff) : "Â∞öÊú™Âü∑Ë°å";
            
            let historyHtml = '';
            evt.logs.forEach((log, index) => {
                historyHtml += `
                    <div class="history-item">
                        <span>${formatDate(log)}</span>
                        <button style="background:none;border:none;color:${isHero?'#fff':'var(--danger)'};cursor:pointer;" onclick="deleteLog(${evt.id}, ${index})">‚úï</button>
                    </div>
                `;
            });

            // SVG Icons
            const iconPin = `<svg class="icon-sm" viewBox="0 0 24 24"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg>`;
            const iconTrash = `<svg class="icon-sm" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`;
            const iconDots = `<svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>`;

            const pinText = evt.isPinned ? "ÂèñÊ∂àÁΩÆÈ†Ç" : "Ë®≠ÁÇ∫ÁΩÆÈ†Ç";
            const containerClass = isHero ? 'hero-card' : 'card';
            const btnClass = isHero ? 'btn-primary' : 'btn-primary'; // Hero button is styled via CSS selector
            const outlineBtnClass = isHero ? 'btn-outline' : 'btn-outline';

            return `
                <div class="${containerClass}" id="card-${evt.id}">
                    <div class="card-header">
                        <div class="event-title">${evt.name}</div>
                        
                        <div class="menu-container">
                            <button class="menu-btn" onclick="toggleMenu(event, ${evt.id})">${iconDots}</button>
                            <div id="menu-${evt.id}" class="dropdown">
                                <div class="dropdown-item" onclick="togglePin(${evt.id})">
                                    ${iconPin} ${pinText}
                                </div>
                                <div class="dropdown-item danger" onclick="deleteEvent(${evt.id})">
                                    ${iconTrash} Âà™Èô§
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="last-date">${lastLog ? '‰∏äÊ¨°Ôºö' + formatDate(lastLog) : 'Êñ∞‰∫ã‰ª∂'}</div>
                    <div class="time-elapsed">${displayTime}</div>
                    
                    <button class="btn ${btnClass}" onclick="logTime(${evt.id})">‚úîÔ∏è Á´ãÂç≥Á¥ÄÈåÑ</button>
                    <button class="btn ${outlineBtnClass}" onclick="toggleHistory(${evt.id})">üìã Ê≠∑Âè≤Á¥ÄÈåÑ</button>
                    
                    <div class="history-list">
                        ${historyHtml || '<div style="opacity:0.6;font-size:0.8rem;padding:5px 0;">Â∞öÁÑ°Á¥ÄÈåÑ</div>'}
                    </div>
                </div>
            `;
        }

        function renderEvents() {
            const heroContainer = document.getElementById('hero-container');
            const listContainer = document.getElementById('event-list');
            const listLabel = document.getElementById('list-label');
            const emptyState = document.getElementById('empty-state');
            
            heroContainer.innerHTML = '';
            listContainer.innerHTML = '';

            if (events.length === 0) {
                emptyState.style.display = 'block';
                listLabel.style.display = 'none';
                return;
            }
            emptyState.style.display = 'none';

            // Find Pinned Event (Priority: explicitly pinned, usually just one)
            const pinnedEvent = events.find(e => e.isPinned);
            const otherEvents = events.filter(e => !e.isPinned);

            // Render Hero
            if (pinnedEvent) {
                heroContainer.innerHTML = `
                    <div class="hero-section">
                        <div class="hero-label">‚òÖ ÈáçÈªûÈóúÊ≥®</div>
                        ${generateCardHTML(pinnedEvent, true)}
                    </div>
                `;
            }

            // Render List
            if (otherEvents.length > 0) {
                listLabel.style.display = pinnedEvent ? 'block' : 'none';
                otherEvents.forEach(evt => {
                    listContainer.innerHTML += generateCardHTML(evt, false);
                });
            } else {
                listLabel.style.display = 'none';
            }
        }

        // --- Navigation ---
        function switchPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            if (pageName === 'home') {
                document.getElementById('home-page').classList.add('active');
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
            } else if (pageName === 'settings') {
                document.getElementById('settings-page').classList.add('active');
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
            }
        }

        function clearAllData() {
            if(confirm("Ë≠¶ÂëäÔºöÈÄôÂ∞áÊúÉÂà™Èô§ÊâÄÊúâË≥áÊñôÔºÅ")) {
                localStorage.removeItem('myTimeTracker_events_v2');
                events = [];
                renderEvents();
                alert("Ë≥áÊñôÂ∑≤Ê∏ÖÈô§");
            }
        }

        // Auto Refresh Timer
        setInterval(() => {
            if(document.getElementById('home-page').classList.contains('active')) renderEvents();
        }, 60000);

        renderEvents();
    </script>
</body>
</html>
